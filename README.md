# Ansible role: Postfix

Install and configure postfix on an Ubuntu or Redhat server.

Primarily for use in hosting environments so a website can deliver mail via 127.0.0.1.

# Test Suite Setup (Molecule)

- To run the whole test suite for all environments
```bash
$ tox
```

## Setup Local Virtual Environment

- to run a single test
```bash
$ python3 -m venv venv
$ source venv/bin/activate
$ pip3 install 'molecule[docker]'
$ pip3 install -r requirements.txt
$ MAIL_RECIPIENT='webmaster@acromedia.com' INV_HOSTNAME='inventory_hostname' POST_HOSTNAME='locahost' POST_NETWORKS='localhost' molecule test --destroy=never
```

- note that you can substitute MOLECULE_DISTRO=version (or other prepended variables):

__MOLECULE_DISTRO List__

    centos7
    centos8
    
    debian8
    debian9
    debian10
    
    ubuntu1604
    ubuntu1804

- look here for more images: https://hub.docker.com/r/geerlingguy/
    
### Development

- if you are creating a new molecule test suite inside an existing role then execute this ...
```bash 
$ molecule init scenario -r ansible-role-postfix
```
- you can change one line and enter a different molecule command to keep the container alive
    - from the ```MOLECULE_DISTRO``` list above, substitute your desired version for development below
    
```bash
    /molecule/molecule.yml
    image: "geerlingguy/docker-${MOLECULE_DISTRO:-debian9}-ansible:latest"
```

- run this command so that the container is not dead
```bash
$ molecule test --destroy=never
```

- ssh into the container after the test
```bash
$ molecule login
```

- run the test suite located in ```molecule/test/test_default.py```
```bash
$ molecule verify
```

## Requirements

* Redhat or Ubuntu

* Your playbook must gather_facts

## Role Variables

* default_mail_recipient: The email address of the person who should receive mail for root (stuff that was generated by the server; ie cron failure notifications)

For servers that accept incoming mail:
* postfix_tls_cert: Absolute path to the TLS public certificate
* postfix_tls_key: Absolute path to the TLS private key

For systems behind a load balancer:
* postfix_myhostname: In some cases, ansible won't be able to figure out what to use for this, so you'll need to specify it manually

Tweaks: These only get applied if your playbook specifies them. Otherwise, the defaults for these are left up to your OS.
* postfix_inet_interfaces: Defaults to "all" on debian, and "localhost" on red hat.
* postfix_mynetworks: Default for both OS's is only to trust localhost.


## Dependencies

None

## Example Playbook

    ---
    - hosts: servers
      roles:
       - name: Install postfix
         role: acromedia.postfix
         default_mail_recipient: webmaster@example.com

## License

GPLv3

## Author Information

Acro Media Inc.
https://www.acromedia.com/
